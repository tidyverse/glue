<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Speed of glue • glue</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Speed of glue">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script><script defer data-domain="glue.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">glue</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.7.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/glue.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/engines.html">glue custom knitr language engines</a></li>
    <li><a class="dropdown-item" href="../articles/speed.html">Speed of glue</a></li>
    <li><a class="dropdown-item" href="../articles/transformers.html">Transformers</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2017/10/glue-1.2.0/">glue 1.2.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/glue/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Speed of glue</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/glue/blob/main/vignettes/articles/speed.Rmd" class="external-link"><code>vignettes/articles/speed.Rmd</code></a></small>
      <div class="d-none name"><code>speed.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bench.r-lib.org/" class="external-link">bench</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>Glue is advertised as</p>
<blockquote>
<p>Fast, dependency free string literals</p>
</blockquote>
<p>So what do we mean when we say that glue is fast? This does not mean
glue is the fastest thing to use in all cases, however for the features
it provides we can confidently say it is fast.</p>
<p>A good way to determine this is to compare its speed of execution to
some alternatives.</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/paste.html" class="external-link">base::paste0()</a></code>, <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">base::sprintf()</a></code>: Functions
in base R implemented in C that provide variable insertion (but not
interpolation).</li>
<li>
<code><a href="https://henrikbengtsson.github.io/R.utils/reference/gstring.html" class="external-link">R.utils::gstring()</a></code>: Provides a similar interface as
glue, but uses <code>${}</code> to delimit blocks to interpolate.</li>
<li>
<code>pystr::pystr_format()</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;pystr is no longer available from CRAN due to failure to
correct installation errors and was therefore removed from further
testing.&lt;/p&gt;"><sup>1</sup></a>,
<code><a href="https://rdrr.io/pkg/rprintf/man/rprintf.html" class="external-link">rprintf::rprintf()</a></code>: Provide an interface similar to python
string formatters with variable replacement, but not arbitrary
interpolation.</li>
</ul>
<p>Note: <code><a href="https://stringr.tidyverse.org/reference/str_interp.html" class="external-link">stringr::str_interp()</a></code> was previously included in
this benchmark, but is now formally marked as “superseded”, in favor of
<code><a href="https://stringr.tidyverse.org/reference/str_glue.html" class="external-link">stringr::str_glue()</a></code>, which just calls
<code><a href="../reference/glue.html">glue::glue()</a></code>.</p>
<div class="section level2">
<h2 id="simple-concatenation">Simple concatenation<a class="anchor" aria-label="anchor" href="#simple-concatenation"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bar</span> <span class="op">&lt;-</span> <span class="st">"baz"</span></span>
<span></span>
<span><span class="va">simple</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  glue       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="../reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"foo{bar}"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  gstring    <span class="op">=</span> <span class="fu">R.utils</span><span class="fu">::</span><span class="fu"><a href="https://henrikbengtsson.github.io/R.utils/reference/gstring.html" class="external-link">gstring</a></span><span class="op">(</span><span class="st">"foo${bar}"</span><span class="op">)</span>,</span>
<span>  paste0     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="va">bar</span><span class="op">)</span>,</span>
<span>  sprintf    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"foo%s"</span>, <span class="va">bar</span><span class="op">)</span>,</span>
<span>  rprintf    <span class="op">=</span> <span class="fu">rprintf</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rprintf/man/rprintf.html" class="external-link">rprintf</a></span><span class="op">(</span><span class="st">"foo$bar"</span>, bar <span class="op">=</span> <span class="va">bar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">expression</span><span class="op">:</span><span class="va">total_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> sprintf       751ns 832.02ns  1<span style="text-decoration: underline;">149</span>336.        0B     0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> paste0       1.46µs   1.57µs   <span style="text-decoration: underline;">611</span>045.        0B    61.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> glue        99.59µs 104.73µs     <span style="text-decoration: underline;">9</span>387.  140.44KB    24.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> gstring    216.09µs  223.2µs     <span style="text-decoration: underline;">4</span>392.    2.45MB    14.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> rprintf    272.65µs 278.94µs     <span style="text-decoration: underline;">3</span>524.  503.39KB     8.20</span></span>
<span></span>
<span><span class="co"># plotting function defined in a hidden chunk</span></span>
<span><span class="fu">plot_comparison</span><span class="op">(</span><span class="va">simple</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `trans` argument of `continuous_scale()` is deprecated as of ggplot2</span></span>
<span><span class="co">#&gt; 3.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use the `transform` argument instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="speed_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>While <code><a href="../reference/glue.html">glue()</a></code> is slower than <code>paste0</code> and
<code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf()</a></code>, it is twice as fast as <code>gstring()</code>,
and <code>rprintf()</code>.</p>
<p>Although <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0()</a></code> and <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf()</a></code> don’t do
string interpolation and will likely always be significantly faster than
glue, glue was never meant to be a direct replacement for them.</p>
<p><code><a href="https://rdrr.io/pkg/rprintf/man/rprintf.html" class="external-link">rprintf::rprintf()</a></code> does only variable interpolation, not
arbitrary expressions, which was one of the explicit goals of writing
glue.</p>
<p>So glue is ~2x as fast as the function (<code>gstring()</code>),
which has roughly equivalent functionality.</p>
<p>It also is still quite fast, with over 8000 evaluations per second on
this machine.</p>
</div>
<div class="section level2">
<h2 id="vectorized-performance">Vectorized performance<a class="anchor" aria-label="anchor" href="#vectorized-performance"></a>
</h2>
<p>Taking advantage of glue’s vectorization is the best way to improve
performance. In a vectorized form of the previous benchmark, glue’s
performance is much closer to that of <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0()</a></code> and
<code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"bar"</span>, <span class="fl">1e5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vectorized</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  glue    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="../reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"foo{bar}"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  gstring <span class="op">=</span> <span class="fu">R.utils</span><span class="fu">::</span><span class="fu"><a href="https://henrikbengtsson.github.io/R.utils/reference/gstring.html" class="external-link">gstring</a></span><span class="op">(</span><span class="st">"foo${bar}"</span><span class="op">)</span>,</span>
<span>  paste0  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="va">bar</span><span class="op">)</span>,</span>
<span>  sprintf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"foo%s"</span>, <span class="va">bar</span><span class="op">)</span>,</span>
<span>  rprintf <span class="op">=</span> <span class="fu">rprintf</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rprintf/man/rprintf.html" class="external-link">rprintf</a></span><span class="op">(</span><span class="st">"foo$bar"</span>, bar <span class="op">=</span> <span class="va">bar</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vectorized</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">expression</span><span class="op">:</span><span class="va">total_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> paste0       8.27ms   8.31ms     118.    781.3KB     6.34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> sprintf      9.09ms   9.19ms     109.    781.3KB     4.19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> gstring     11.08ms   11.2ms      89.1    1.53MB     8.91</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> glue        11.61ms  12.32ms      79.9    2.29MB     9.13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> rprintf     29.68ms   29.8ms      33.5    3.05MB    10.3</span></span>
<span></span>
<span><span class="co"># plotting function defined in a hidden chunk</span></span>
<span><span class="fu">plot_comparison</span><span class="op">(</span><span class="va">vectorized</span><span class="op">)</span></span></code></pre></div>
<p><img src="speed_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.jimhester.com/" class="external-link">Jim Hester</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

  </div></footer>
</body>
</html>
